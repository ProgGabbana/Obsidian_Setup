/*
    Source: https://github.com/BudinoSurelySweet/Obsidian-Sweet-Sidenotes
*/
:root {
	/* =======================================================
	   CONFIGURAZIONE: MODIFICA I VALORI DIRETTAMENTE QUI
	   ======================================================= */
	--icon: "lucide-notepad-text";

	--max-width: 15em;
	--gap: 3em;
	--vertical-offset: -1em;
	--opacity: 0.5;
	--border-width: 0px; /* Usa un valore > 0 per vedere il colore della penna sul bordo */

	--font-size: 0.85em;

	--padding-top: 10px;
	--padding-right: 20px;
	--padding-bottom: 10px;
	--padding-left: 20px;

	--hover-anim-final-value: 1;
	--hover-anim-duration: 0.3;

	/* Variabili per l'aggiustamento della larghezza (metadata |small, |medium, ecc.) */
	--width-adj-small: 5em;
	--width-adj-medium: 10em;
	--width-adj-large: 15em;
	--width-adj-larger: 20em;
}

/* =======================================================
   REGOLE PRINCIPALI: SIDENOTE SINGOLA (POSIZIONAMENTO ASSOLUTO)
   ======================================================= */

/* Stile applicato a tutte le callout [!sidenote] */
.callout[data-callout~=sidenote] {
	position: absolute; 
	max-width: var(--max-width);
	font-size: var(--font-size);
	border-width: var(--border-width);

	padding-top: var(--padding-top);
	padding-right: var(--padding-right);
	padding-bottom: var(--padding-bottom);
	padding-left: var(--padding-left);

	opacity: var(--opacity);
	transition: opacity calc(var(--hover-anim-duration) * 1s);

	/* Posizionamento a destra */
	text-align: left;
	margin: unset;
	margin-left: calc(var(--file-line-width) + var(--gap));
}

/* Sidenote a sinistra: usa i metadati |left */
.callout[data-callout~=sidenote]:is([data-callout-metadata~=left]) {
	text-align: right;
	margin: unset;
	margin-left: calc(-1 * (var(--max-width) + var(--gap)));
}

/* Animazione al passaggio del mouse */
.callout[data-callout~=sidenote]:hover {
	opacity: var(--hover-anim-final-value);
}

/* =======================================================
   COMPATIBILITÃ€ COLORE TEMA "PAGE & PEN"
   ======================================================= */

/* Sfondo e Testo (Comune a tutti i temi) */
:is(.manila, .white, .blue, .pink, .gray, .white-pen, .blue-pen, .red-pen, .green-pen, .black-pen, .gray-pen, .purple-pen, .yellow-pen) .callout[data-callout~=sidenote] {
    /* Sfondo: Usa il colore della pagina e schiariscilo/scuriscilo leggermente */
    --callout-color: color-mix(in srgb, var(--page-color) 90%, var(--accent-color-trans));
    
    /* Bordo: Usa il colore della penna */
    --callout-border-color: var(--accent-color);
    
    /* Testo: Usa il colore della penna (accent-color) */
    color: var(--accent-color);
}


/* Overrides per Temi Scuri (Blue, Gray) - Assicura testo chiaro su sfondo scuro */
:is(.blue, .gray) .callout[data-callout~=sidenote] {
    /* Testo (opzionale): Usa il bianco come fallback */
    color: var(--white); 
    
    /* Sfondo: Scurisci la pagina per il sidenote */
    --callout-color: color-mix(in srgb, var(--page-color) 80%, black);
    
    /* Bordo: Usa il colore della penna (accent-color) */
    --callout-border-color: var(--accent-color);
}

/* =======================================================
   REGOLE SIDENOTE GRUPPO (RISOLUZIONE SOVRAPPOSIZIONE)
   ======================================================= */

/* 1. DEFINIZIONE DEL CONTENITORE DI GRUPPO: Lo posiziona in assoluto, ma il contenuto fluisce */
.callout[data-callout~=sidenote-group] {
    position: absolute; 
    max-width: var(--max-width); 
    margin: unset;
    border: none;
    background: unset;
    box-shadow: none;
    padding: 0;

    /* Posizionamento a destra */
    margin-left: calc(var(--file-line-width) + var(--gap));
    
    /* Rimuove icona e titolo del contenitore di gruppo */
    & > .callout-title { display: none; }
    & > .callout-content { 
        padding: 0; 
        display: block; 
    }
}

/* 2. GESTIONE DEI SINGOLI SIDENOTE ALL'INTERNO DEL GRUPPO: Rimuove l'assoluto */
.callout[data-callout~=sidenote-group] > .callout-content > .callout[data-callout~=sidenote] {
    position: static; 
    margin-block: 0.5em; /* Spazio tra le note nel gruppo */
    margin-inline: 0;
    max-width: 100%; 
}

/* 3. GESTIONE DEL GRUPPO A SINISTRA */
.callout[data-callout~=sidenote-group]:is([data-callout-metadata~=left]) {
    margin-left: calc(-1 * (var(--max-width) + var(--gap)));
}

/* 4. GESTIONE DEL GRUPPO IN LIVE PREVIEW */
.is-live-preview .callout[data-callout~=sidenote-group] {
    position: relative;
    margin-left: 0 !important;
    max-width: 100%;
}

/* =======================================================
   REGOLE DI ADATTAMENTO E PULIZIA
   ======================================================= */

/* Pulizia generale */
.callout[data-callout~=sidenote] p { margin: 0; }
.callout[data-callout~=sidenote] .callout-title { --callout-title-padding: 0; }
.callout[data-callout~=sidenote] .callout-content { padding: 0; }
.callout[data-callout~=sidenote] .callout-title .callout-icon {
	margin-top: var(--vertical-offset);
	display: none;
}
.callout[data-callout~=sidenote]:not([data-callout-metadata~=show-title]) .callout-title-inner {
	display: none;
}

/* Personalizzazione Live Preview */
.is-live-preview .callout[data-callout~=sidenote] {
	position: relative;
	margin: unset;
	margin-left: 24em !important;
}

.is-live-preview .callout[data-callout~=sidenote]:is([data-callout-metadata~=left]) {
	position: relative;
	margin: unset;
	margin-left: 0em !important;
}

/* Icona */
.callout[data-callout~=sidenote] {
	--callout-icon: var(--icon);
}

/* =======================================================
   REGOLE DI LARGHEZZA (METADATA |small, |medium, ecc.)
   ======================================================= */

/* Larghezza Sidenote Singola */
.callout[data-callout~=sidenote][data-callout-metadata=small] {
	max-width: calc(var(--max-width) + var(--width-adj-small));
}
.callout[data-callout~=sidenote][data-callout-metadata~=left][data-callout-metadata~=small] {
	max-width: calc(var(--max-width) + var(--width-adj-small));
	margin-left: calc(-1 * (var(--max-width) + var(--gap) + var(--width-adj-small)));
}

.callout[data-callout~=sidenote][data-callout-metadata=medium] {
	max-width: calc(var(--max-width) + var(--width-adj-medium));
}
.callout[data-callout~=sidenote][data-callout-metadata~=left][data-callout-metadata~=medium] {
	max-width: calc(var(--max-width) + var(--width-adj-medium));
	margin-left: calc(-1 * (var(--max-width) + var(--gap) + var(--width-adj-medium)));
}

.callout[data-callout~=sidenote][data-callout-metadata=large] {
	max-width: calc(var(--max-width) + var(--width-adj-large));
}
.callout[data-callout~=sidenote][data-callout-metadata~=left][data-callout-metadata~=large] {
	max-width: calc(var(--max-width) + var(--width-adj-large));
	margin-left: calc(-1 * (var(--max-width) + var(--gap) + var(--width-adj-large)));
}

.callout[data-callout~=sidenote][data-callout-metadata=larger] {
	max-width: calc(var(--max-width) + var(--width-adj-larger));
}
.callout[data-callout~=sidenote][data-callout-metadata~=left][data-callout-metadata~=larger] {
	max-width: calc(var(--max-width) + var(--width-adj-larger));
	margin-left: calc(-1 * (var(--max-width) + var(--gap) + var(--width-adj-larger)));
}


/* Larghezza Sidenote nel Gruppo */
.callout[data-callout~=sidenote-group] .callout[data-callout~=sidenote][data-callout-metadata=small] {
	max-width: calc(var(--max-width) + var(--width-adj-small));
}
.callout[data-callout~=sidenote-group] .callout[data-callout~=sidenote][data-callout-metadata=medium] {
	max-width: calc(var(--max-width) + var(--width-adj-medium));
}
.callout[data-callout~=sidenote-group] .callout[data-callout~=sidenote][data-callout-metadata=large] {
	max-width: calc(var(--max-width) + var(--width-adj-large));
}
.callout[data-callout~=sidenote-group] .callout[data-callout~=sidenote][data-callout-metadata=larger] {
	max-width: calc(var(--max-width) + var(--width-adj-larger));
}